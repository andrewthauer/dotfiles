#!/bin/zsh

# Create symlink to this directory
SOURCE_DOTFILES=$(cd $(dirname $0); pwd)
TARGET_DOTFILES="$HOME/.dotfiles"
if [[ ! -d "${TARGET_DOTFILES}" ]] && [[ ! -L "${TARGET_DOTFILES}" ]]; then
  ln -s "${SOURCE_DOTFILES}" "${TARGET_DOTFILES}"
fi

# Export dot files dir
export DOTFILES="$HOME/.dotfiles"

# Initialize
[[ -s "${DOTFILES}/init.zsh" ]] && source "${DOTFILES}/init.zsh"

# Symlink directories
echo "\n=== Symlinking files & directories ===\n"
dotfiles_symlink_dir "${DOTFILES}/bash"
dotfiles_symlink_dir "${DOTFILES}/editorconfig"
dotfiles_symlink_dir "${DOTFILES}/git"
dotfiles_symlink_dir "${DOTFILES}/node"
dotfiles_symlink_dir "${DOTFILES}/secrets"
dotfiles_symlink_dir "${DOTFILES}/slate"
dotfiles_symlink_dir "${DOTFILES}/vim"
dotfiles_symlink_dir "${DOTFILES}/zsh"
dotfiles_symlink_dir "${DOTFILES}/ruby"

# Update zgen
echo "\n=== Updating zgen ===\n"
pushd ${DOTFILES} > /dev/null
git submodule update --init --recursive
popd /dev/null
dotfiles_require 'zgen'
zgen update

# Reload zsh
echo "\n=== Restarting your shell ===\n"
source ~/.zshrc
