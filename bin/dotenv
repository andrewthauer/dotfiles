#!/usr/bin/env sh
#
# Dotenv helpers & aliases
#
# Note:
#   On macOS `envsubst` requires gettext:
#     brew install gettext
#     brew link --force gettext
#

set -o errexit -o pipefail -o noclobber -o nounset

dotenv_read () {
  local file="${DOTENV_FILE:-${1:-.env}}"
  cat "${file}" | grep -v "^#" | grep -v -e "^$"
}

dotenv_exec() {
  env $(dotenv-read) "${@:1}"
}

dotenv_export() {
  export $(dotenv-read | xargs)
}

dotenv_subst() {
  if ! [ -x "$(command -v envsubst)" ]; then
    echo "Command 'envsubst' not found. Please install the 'gettext' package"
    exit 1
  fi

  dotenv-exec envsubst < "${1}"
}

#
# Execute
#

cmd=$1
args=${@:2}
dotenv_cmd="dotenv_${cmd}"

# Execute the command
if [ $(command -v $dotenv_cmd) ]; then
  $dotenv_cmd $args 2>&1
else
  dotenv_read
fi
