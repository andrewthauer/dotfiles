#!/usr/bin/env zsh

echo "=== Lightroom Sync Tool ==="

# Get command
CMD=$1
if [ -z $CMD ]; then
  echo ""
  echo "No command specified"
  echo ""
  echo "Usage:"
  echo "  lr-sync (restore | backup | test) <dry-run>"
  return -1
fi

# Is this a dry run
DRY_RUN=$2
if [ "$DRY_RUN" = "dry-run" ]; then
  DRY_RUN="--dry-run"
else
  DRY_RUN=
fi

EXCLUDES="${NAS_RSYNC_EXCLUDE_OPTS}"
NAS_DIR="${NAS_LIGHTROOM_DIR}"
LOCAL_DIR="${LOCAL_LIGHTROOM_DIR}"

echo "Command: ${CMD}"
echo "Dry Run: ${DRY_RUN}"
echo "Excluding: ${EXCLUDES}"
echo ""

if [ "$CMD" = "restore" ]; then
  echo "Restoring lightroom from nas ..."
  rsync_cmd="rsync -av ${DRY_RUN} ${EXCLUDES} --delete --stats --progress -e ssh ${NAS_USER}@${NAS_HOST}:${NAS_DIR} ${LOCAL_DIR}"
  eval $rsync_cmd
  return 0
fi

if [ "$CMD" = "backup" ]; then
  echo "Backing up lightroom to nas ..."
  rsync_cmd="rsync -av ${DRY_RUN} ${EXCLUDES} --delete --stats --progress ${LOCAL_DIR} -e ssh ${NAS_USER}@${NAS_HOST}:${NAS_DIR}"
  eval $rsync_cmd
  return 0
fi
