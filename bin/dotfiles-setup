#!/usr/bin/env zsh
#
# description:
#   Setup script for install dotfiles
#

# Create symlink to the parent directory
SOURCE_DOTFILES=$(cd $(dirname $0)/..; pwd)
TARGET_DOTFILES="$HOME/.dotfiles"
if [[ ! -d "${TARGET_DOTFILES}" ]] && [[ ! -L "${TARGET_DOTFILES}" ]]; then
  ln -s "${SOURCE_DOTFILES}" "${TARGET_DOTFILES}"
fi

# Export dotfiles dir
DOTFILES_DIR="${DOTFILES_DIR:-$HOME/.dotfiles}"

# Symlink directories
echo "Symlinking files & directories ..."
"${DOTFILES_DIR}/bin/dotfiles-symlink"

# Initialize zplug
ZPLUG_HOME="${ZPLUG_HOME:-$HOME/.zplug}"
if [[ ! -d "${ZPLUG_HOME}" ]] || [[ ! -d "${ZPLUG_HOME}/repos/zplug/zplug" ]]; then
  git clone https://github.com/zplug/zplug "${HOME}/.zplug/repos/zplug/zplug"
  ln -s "${HOME}/.zplug/repos/zplug/zplug/init.zsh" "${HOME}/.zplug/init.zsh"
fi

# Update dotfiles
echo "\nUpdating zplug ..."
"${DOTFILES_DIR}/bin/dotfiles-update"

# Reload zsh
echo "\nReloading zsh ..."
source ~/.zshrc
