#!/usr/bin/env bash
# Summary:
#   Manage dotfiles
#
# Usage:
#   dotfiles [command]
#   dotfiles help

set -o errexit -o pipefail -o noclobber

usage() {
  echo "USAGE: dotfiles [command]"
  echo ""
  echo "COMMANDS:"
  echo "  backup     Backups up the local dotfiles directory"
  echo "  module     Manage dotfile modules"
  echo "  package    Manage system packages"
  echo "  help       Prints this message"
}

main() {
  cmd="$1"
  [ -n "$cmd" ] && shift

  case "$cmd" in
    backup)
      dotfiles-backup "$@"
      ;;
    module | modules | mod | m)
      dotfiles-module "$@"
      ;;
    package | pkg | p)
      pkg "$@"
      ;;
    help | h | --help | -h)
      usage
      ;;
    *)
      sub_cmd="dotfiles-${cmd}"
      if [[ -x $(command -v "$sub_cmd") ]]; then
        $sub_cmd "$@" 2>&1
      else
        usage
      fi
      ;;
  esac
}

main "$@"
